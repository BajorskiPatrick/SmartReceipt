openapi: 3.0.3
info:
  title: "Smart Receipt API"
  version: "1.0.0"

servers:
  - url: "http://localhost:8080/api/v1.0"
    description: "Main backend server (Spring Boot)"
  - url: "http://localhost:8000/api/v1.0"
    description: "AI/ML module server (FastAPI)"

tags:
  - name: "MainApp"
    description: "Endpoints exposed by the main backend (Spring Boot) for the client application (React)."
  - name: "OcrModule"
    description: "Internal AI module endpoints (FastAPI) used by the backend."

paths:
  /auth/register:
    post:
      operationId: registerUser
      tags:
        - "MainApp"
      summary: "Register new user"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserRegistration'
      responses:
        '201':
          description: "User successfully registered"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResponse"
        '400':
          description: "Invalid input data"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: "Internal server error"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/login:
    post:
      operationId: loginUser
      tags:
        - "MainApp"
      summary: "User login"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserLogin'
      responses:
        '200':
          description: "Successful login"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          description: "Invalid input data"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: "Invalid credentials"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: "Internal server error"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/logout:
    post:
      operationId: logoutUser
      tags:
        - "MainApp"
      summary: "User logout"
      security:
        - bearerAuth: [ ]
      responses:
        '200':
          description: "Successfully logged out"
        '500':
          description: "Internal server error"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/refresh:
    post:
      operationId: userTokenRefresh
      tags:
        - "MainApp"
      summary: "Refresh user token"
      responses:
        '200':
          description: "Token successfully refreshed"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RefreshedToken'
        '400':
          description: "Token refresh failed"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: "Internal server error"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /expenses/upload:
    post:
      operationId: uploadReceipt
      tags:
        - "MainApp"
      summary: "Upload receipt image for processing"
      description: "Endpoint accepts a receipt image. The backend sends it to the AI module for data extraction (OCR) and categorization, then returns an expense ready for the user to accept and add."
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                image:
                  type: string
                  format: binary
                  description: "Receipt image file"
                data:
                  $ref: '#/components/schemas/NewOcrExpense'
      responses:
        '200':
          description: "Receipt processed successfully"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OcrExpense'
        '400':
          description: "Invalid file or validation error"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: "Resource not found"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '417':
          description: "File size exceeds maximum limit (10MB)"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '502':
          description: "OCR processing failed"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: "Internal server error"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /expenses/manual:
    post:
      operationId: addManualExpense
      tags:
        - "MainApp"
      summary: "Manually add expense"
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewExpense'
      responses:
        '201':
          description: "Expense added successfully"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExpenseDetails'
        '400':
          description: "Invalid input data"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: "Resource not found"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: "Internal server error"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /expenses:
    get:
      operationId: getExpensesList
      tags:
        - "MainApp"
      summary: "Get expense history (for Widget 3)"
      description: "Returns a list of expenses for the logged-in user. Key endpoint for Widget 3 on the dashboard. Supports filtering by date (year/month) and category. Supports pagination by default."
      security:
        - bearerAuth: [ ]
      parameters:
        - name: year
          in: query
          required: true
          schema:
            type: integer
            example: 2025
          description: "Year for which expenses are fetched"
        - name: month
          in: query
          required: true
          schema:
            type: integer
            example: 11
          description: "Month (1-12) for which expenses are fetched"
        - name: categoryId
          in: query
          required: false
          schema:
            type: string
            format: uuid
            example: "f47ac10b-58cc-4372-a567-0e02b2c3d479"
            description: "From which category expenses should be fetched"
        - name: page
          in: query
          required: false
          schema:
            type: integer
            default: 0
            example: 0
            description: "Page number (for pagination)"
        - name: size
          in: query
          required: false
          schema:
            type: integer
            default: 20
            example: 20
            description: "Number of elements per page"
      responses:
        '200':
          description: "Paginated list of expenses"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExpenseSummaryPage'
        '400':
          description: "Invalid input parameters"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: "Internal server error"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /expenses/{expenseId}:
    get:
      operationId: getExpenseDetails
      tags:
        - "MainApp"
      summary: "Get full expense details (with items)"
      description: "Fetches the full expense object, including a list of all its items. Used when the user clicks 'Details' on the list."
      security:
        - bearerAuth: [ ]
      parameters:
        - name: expenseId
          in: path
          required: true
          description: "ID of the expense to fetch details for"
          schema:
            type: string
            format: uuid
            example: "a1b2c3d4-e5f6-7890-1234-567890abcdef"
        - name: categoryId
          in: query
          required: false
          description: "Category which expense items we want to see in details"
          schema:
            type: string
            format: uuid
            example: "f47ac10b-58cc-4372-a567-0e02b2c3d479"
      responses:
        '200':
          description: "Expense details"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExpenseDetails'
        '404':
          description: "Expense not found"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: "Internal server error"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    put:
      operationId: updateExpense
      tags:
        - "MainApp"
      summary: "Update entire expense"
      description: "Updates basic information about the expense and all its items. The items list is replaced with the new one."
      security:
        - bearerAuth: [ ]
      parameters:
        - name: expenseId
          in: path
          required: true
          description: "ID of the expense to update"
          schema:
            type: string
            format: uuid
            example: "a1b2c3d4-e5f6-7890-1234-567890abcdef"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewExpense'
      responses:
        '200':
          description: "Expense updated successfully"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExpenseDetails'
        '400':
          description: "Invalid input data"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: "Expense not found"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: "Internal server error"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    delete:
      operationId: deleteExpense
      tags:
        - "MainApp"
      summary: "Delete expense"
      description: "Deletes the expense along with all its items."
      security:
        - bearerAuth: [ ]
      parameters:
        - name: expenseId
          in: path
          required: true
          description: "ID of the expense to delete"
          schema:
            type: string
            format: uuid
            example: "a1b2c3d4-e5f6-7890-1234-567890abcdef"
      responses:
        '204':
          description: "Expense deleted successfully"
        '404':
          description: "Expense not found"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: "Internal server error"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /expenses/{expenseId}/items/{itemId}:
    put:
      operationId: updateExpenseItem
      tags:
        - "MainApp"
      summary: "Update specific expense item"
      description: "Updates details of a single item in the expense (e.g., product name, price, category)."
      security:
        - bearerAuth: [ ]
      parameters:
        - name: expenseId
          in: path
          required: true
          description: "Expense ID"
          schema:
            type: string
            format: uuid
            example: "a1b2c3d4-e5f6-7890-1234-567890abcdef"
        - name: itemId
          in: path
          required: true
          description: "ID of the item to update"
          schema:
            type: string
            format: uuid
            example: "b2c3d4e5-f6g7-8901-2345-678901bcdefg"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewExpenseItem'
      responses:
        '200':
          description: "Item updated successfully"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExpenseItem'
        '400':
          description: "Invalid input data"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: "Expense or item not found"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: "Internal server error"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    delete:
      operationId: deleteExpenseItem
      tags:
        - "MainApp"
      summary: "Delete specific expense item"
      description: "Removes a single item from the expense. The total amount and item count are automatically recalculated."
      security:
        - bearerAuth: [ ]
      parameters:
        - name: expenseId
          in: path
          required: true
          description: "Expense ID"
          schema:
            type: string
            format: uuid
            example: "a1b2c3d4-e5f6-7890-1234-567890abcdef"
        - name: itemId
          in: path
          required: true
          description: "ID of the item to delete"
          schema:
            type: string
            format: uuid
            example: "b2c3d4e5-f6g7-8901-2345-678901bcdefg"
      responses:
        '204':
          description: "Item deleted successfully"
        '404':
          description: "Expense or item not found"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: "Internal server error"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /budgets:
    get:
      operationId: getUserBudget
      tags:
        - "MainApp"
      summary: "Get current user budget (for this month)"
      security:
        - bearerAuth: [ ]
      parameters:
        - name: year
          in: query
          required: true
          schema:
            type: integer
            example: 2025
          description: "Budget year"
        - name: month
          in: query
          required: true
          schema:
            type: integer
            example: 11
          description: "Budget month"
      responses:
        '200':
          description: "User budget for the current month"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MonthlyBudget'
        '400':
          description: "Invalid input parameters"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: "Internal server error"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    post:
      operationId: createUserBudget
      tags:
        - "MainApp"
      summary: "Create new user budget"
      security:
        - bearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewMonthlyBudget'
      responses:
        '201':
          description: "Budget created successfully"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MonthlyBudget'
        '400':
          description: "Invalid input data or budget for this month already exists"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: "Internal server error"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /budgets/{budgetId}:
    put:
      operationId: updateUserBudget
      tags:
        - "MainApp"
      summary: "Update user budget"
      security:
        - bearerAuth: []
      parameters:
        - name: budgetId
          in: path
          required: true
          schema:
            type: string
            format: uuid
            example: "e5f6g7h8-i9j0-1234-5678-901234efghij"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewMonthlyBudget'
      responses:
        '200':
          description: "Budget updated successfully"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MonthlyBudget'
        '400':
          description: "Invalid input data"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: "Budget not found"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: "Internal server error"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /dashboard:
    get:
      operationId: getDashboardData
      tags:
        - "MainApp"
      summary: "Get aggregated dashboard data"
      description: "Returns all data needed for the initial dashboard load for a given month (KPI, Widget 1 - categories, Widget 2 - trend)."
      security:
        - bearerAuth: []
      parameters:
        - name: year
          in: query
          required: true
          schema:
            type: integer
            example: 2025
          description: "Year for analysis"
        - name: month
          in: query
          required: true
          schema:
            type: integer
            example: 11
          description: "Month for analysis (1-12). The 6-month trend will be calculated backwards from this date."
      responses:
        '200':
          description: "Aggregated dashboard data"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DashboardData'
        '400':
          description: "Invalid input parameters"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: "Internal server error"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /dashboard/yearly-spending-summary:
    get:
      operationId: getYearlySpendingSummary
      tags:
        - "MainApp"
      summary: "Get yearly spending summary data"
      description: "Returns aggregated budget and spending data for the entire year, used in the yearly spending summary view on the dashboard."
      security:
        - bearerAuth: []
      parameters:
        - name: year
          in: query
          required: true
          schema:
            type: integer
            example: 2025
          description: "Year for which the summary is fetched"
      responses:
        '200':
          description: "Yearly spending summary data"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/YearlySpendingSummary'
        '400':
          description: "Invalid input parameters"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: "Internal server error"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /categories:
    get:
      operationId: getCategories
      tags:
        - "MainApp"
      summary: "Get all user categories"
      description: "Returns a list of user-defined expense categories (e.g., for the dropdown when manually adding an expense or filtering)."
      security:
        - bearerAuth: [ ]
      responses:
        '200':
          description: "List of categories"
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Category'
        '500':
          description: "Internal server error"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    post:
      operationId: createCategory
      tags:
        - "MainApp"
      summary: "Create new expense category"
      security:
        - bearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewCategory'
      responses:
        '201':
          description: "Category created"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Category'
        '400':
          description: "Invalid input data"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: "Internal server error"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /categories/{categoryId}:
    put:
      operationId: updaetCategory
      tags:
        - "MainApp"
      summary: "Update category"
      description: "Updates category information - name and description"
      security:
        - bearerAuth: [ ]
      parameters:
        - name: categoryId
          in: path
          required: true
          description: "ID of the category to update"
          schema:
            type: string
            format: uuid
            example: "f47ac10b-58cc-4372-a567-0e02b2c3d479"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewCategory'
      responses:
        '200':
          description: "Category updated successfully"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Category'
        '400':
          description: "Invalid input data"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: "Category not found"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: "Internal server error"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    delete:
      operationId: deleteCategory
      tags:
        - "MainApp"
      summary: "Delete category"
      description: "Deletes a category. Sets the 'deleted' flag to true so it is not returned as an available choice, but old expenses do not lose their category."
      security:
        - bearerAuth: [ ]
      parameters:
        - name: categoryId
          in: path
          required: true
          description: "Category ID"
          schema:
            type: string
            format: uuid
            example: "f47ac10b-58cc-4372-a567-0e02b2c3d479"
      responses:
        '204':
          description: "Category deleted successfully"
        '404':
          description: "Category not found"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: "Internal server error"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /admin/users:
    get:
      operationId: getAllUsers
      tags:
        - "MainApp"
      summary: "Get all users (admin only)"
      security:
        - bearerAuth: [ ]
      responses:
        '200':
          description: "List of all registered users"
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserResponse'
        '500':
          description: "Internal server error"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    post:
      operationId: createUserByAdmin
      tags:
        - "MainApp"
      summary: "Create new user (admin only)"
      security:
        - bearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewUserByAdmin'
      responses:
          '201':
            description: "User created successfully"
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/UserResponse'
          '400':
            description: "Invalid input data"
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/ErrorResponse'
          '500':
            description: "Internal server error"
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/ErrorResponse'

  /admin/users/{userId}:
    delete:
      operationId: deleteUserByAdmin
      tags:
        - "MainApp"
      summary: "Delete user (admin only)"
      security:
        - bearerAuth: [ ]
      parameters:
        - name: userId
          in: path
          required: true
          description: "ID of the user to delete"
          schema:
            type: string
            format: uuid
            example: "d4e5f6g7-h8i9-0123-4567-890123fghijk"
      responses:
        '204':
          description: "User deleted successfully"
        '404':
          description: "User not found"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: "Internal server error"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    put:
      operationId: updateUserByAdmin
      tags:
        - "MainApp"
      summary: "Update user details (admin only)"
      security:
        - bearerAuth: [ ]
      parameters:
        - name: userId
          in: path
          required: true
          description: "ID of the user to update"
          schema:
            type: string
            format: uuid
            example: "d4e5f6g7-h8i9-0123-4567-890123fghijk"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewUserByAdmin'
      responses:
        '200':
          description: "User updated successfully"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '400':
          description: "Invalid input data"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: "User not found"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: "Internal server error"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /ai/ocr/process:
    post:
      operationId: processReceiptOcr
      tags:
        - "OcrModule"
      summary: "Process receipt image (OCR)"
      description: "AI module endpoint that accepts an image and returns structured data in JSON format. Uses libraries such as Tesseract, easyocr, or PaddleOCR."
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                image:
                  type: string
                  format: binary
                  example: "binary_image_content_here"
      responses:
        '200':
          description: "Receipt data extracted successfully"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OcrResult'
        '400':
          description: "Failed to process image"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    UserRegistration:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          maxLength: 100
          example: "john.doe@example.com"
        password:
          type: string
          format: password
          minLength: 8
          maxLength: 64
          description: "Password must be between 8 and 64 characters"
          example: "super_secret_password"

    UserLogin:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          maxLength: 100
          example: "john.doe@example.com"
        password:
          type: string
          format: password
          maxLength: 64
          example: "super_secret_password"

    AuthResponse:
      type: object
      properties:
        email:
          type: string
          example: "john.doe@example.com"
        token:
          type: string
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        role:
          $ref: "#/components/schemas/Role"

    ExpenseDetails:
      type: object
      required:
        - transactionDate
        - totalAmount
        - itemCount
        - expenseId
        - items
      properties:
        description:
          type: string
          maxLength: 255
          example: "Weekly grocery shopping in Lidl"
        transactionDate:
          type: string
          format: date-time
          example: "2025-11-15T14:30:00Z"
        totalAmount:
          type: number
          format: float
          minimum: 0.00
          example: 125.50
        itemCount:
          type: integer
          minimum: 0
          example: 5
        expenseId:
          type: string
          format: uuid
          example: "a1b2c3d4-e5f6-7890-1234-567890abcdef"
        items:
          type: array
          items:
            $ref: '#/components/schemas/ExpenseItem'

    ExpenseSummary:
      type: object
      required:
        - transactionDate
        - totalAmount
        - itemCount
        - expenseId
      properties:
        description:
          type: string
          maxLength: 255
          example: "Weekly grocery shopping in Lidl"
        transactionDate:
          type: string
          format: date-time
          example: "2025-11-15T14:30:00Z"
        totalAmount:
          type: number
          format: float
          minimum: 0.00
          example: 125.50
        itemCount:
          type: integer
          minimum: 0
          example: 5
        expenseId:
          type: string
          format: uuid
          example: "a1b2c3d4-e5f6-7890-1234-567890abcdef"

    OcrExpense:
      type: object
      required:
        - transactionDate
        - totalAmount
        - itemCount
        - items
      properties:
        description:
          type: string
          maxLength: 255
          example: "Weekly grocery shopping in Lidl"
        transactionDate:
          type: string
          format: date-time
          example: "2025-11-15T14:30:00Z"
        totalAmount:
          type: number
          format: float
          minimum: 0.00
          example: 125.50
        itemCount:
          type: integer
          minimum: 0
          example: 5
        items:
          type: array
          items:
            $ref: '#/components/schemas/OcrExpenseItem'


    ExpenseSummaryPage:
      type: object
      description: "Standard response object for pagination"
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/ExpenseSummary'
        page:
          type: integer
          minimum: 0
          example: 0
        size:
          type: integer
          minimum: 1
          example: 20
        totalPages:
          type: integer
          minimum: 0
          example: 5
        totalElements:
          type: integer
          minimum: 0
          example: 98

    NewExpense:
      type: object
      required:
        - transactionDate
      properties:
        description:
          type: string
          maxLength: 255
          example: "Weekly grocery shopping in Lidl"
        transactionDate:
          type: string
          format: date-time
          example: "2025-11-15T14:30:00Z"
        items:
          type: array
          description: "List of items. Can be empty if adding just a general expense."
          items:
            $ref: '#/components/schemas/NewExpenseItem'

    NewOcrExpense:
      type: object
      required:
        - transactionDate
      properties:
        description:
          type: string
          maxLength: 255
          example: "Receipt from Shell station"
        transactionDate:
          type: string
          format: date-time
          example: "2025-11-15T10:00:00Z"

    ExpenseItem:
      type: object
      required:
        - productName
        - quantity
        - price
        - categoryId
        - expenseItemId
        - categoryName
      properties:
        productName:
          type: string
          minLength: 1
          maxLength: 150
          example: "Milk 2%"
        quantity:
          type: integer
          minimum: 1
          default: 1
          example: 2
        price:
          type: number
          format: float
          minimum: 0.00
          description: "Price per unit, cannot be negative"
          example: 3.50
        categoryId:
          type: string
          format: uuid
          description: "Category ID (optional, as OCR might not recognize it)"
          example: "f47ac10b-58cc-4372-a567-0e02b2c3d479"
        expenseItemId:
          type: string
          format: uuid
          example: "b2c3d4e5-f6g7-8901-2345-678901bcdefg"
        categoryName:
          type: string
          example: "Food"

    NewExpenseItem:
      type: object
      required:
        - productName
        - quantity
        - price
        - categoryId
      properties:
        productName:
          type: string
          minLength: 1
          maxLength: 150
          example: "Milk 2%"
        quantity:
          type: integer
          minimum: 1
          default: 1
          example: 2
        price:
          type: number
          format: float
          minimum: 0.00
          description: "Price per unit, cannot be negative"
          example: 3.50
        categoryId:
          type: string
          format: uuid
          description: "Category ID (optional, as OCR might not recognize it)"
          example: "f47ac10b-58cc-4372-a567-0e02b2c3d479"

    OcrResultExpenseItem:
      type: object
      required:
        - productName
        - quantity
        - price
        - categoryName
      properties:
        productName:
          type: string
          minLength: 1
          maxLength: 150
          example: "Milk 2%"
        quantity:
          type: integer
          minimum: 1
          default: 1
          example: 2
        price:
          type: number
          format: float
          minimum: 0.00
          description: "Price per unit, cannot be negative"
          example: 3.50
        categoryName:
          type: string
          example: "Food"

    OcrExpenseItem:
      type: object
      required:
        - productName
        - quantity
        - price
        - categoryId
      properties:
        productName:
          type: string
          minLength: 1
          maxLength: 150
          example: "Milk 2%"
        quantity:
          type: integer
          minimum: 1
          default: 1
          example: 2
        price:
          type: number
          format: float
          minimum: 0.00
          description: "Price per unit, cannot be negative"
          example: 3.50
        categoryId:
          type: string
          format: uuid
          description: "Category ID (optional, as OCR might not recognize it)"
          example: "f47ac10b-58cc-4372-a567-0e02b2c3d479"

    DashboardData:
      type: object
      properties:
        kpi:
          $ref: '#/components/schemas/DashboardKpi'
        categorySummary:
          type: array
          items:
            $ref: '#/components/schemas/DashboardCategorySummaryItem'
        trendSummary:
          type: array
          items:
            $ref: '#/components/schemas/DashboardTrendItem'

    DashboardKpi:
      type: object
      properties:
        totalSpendingMonth:
          type: number
          format: float
          example: 2450.00
        budget:
          type: number
          format: float
          example: 3000.00

    DashboardCategorySummaryItem:
      type: object
      properties:
        categoryId:
          type: string
          format: uuid
          example: "f47ac10b-58cc-4372-a567-0e02b2c3d479"
        categoryName:
          type: string
          example: "Food"
        totalSpendingMonth:
          type: number
          format: float
          example: 1200.50
        budget:
          type: number
          format: float
          example: 1500.00

    DashboardTrendItem:
      type: object
      properties:
        year:
          type: integer
          example: 2025
        month:
          type: integer
          minimum: 1
          maximum: 12
          example: 10
        totalAmount:
          type: number
          format: float
          example: 2100.00

    Category:
      type: object
      required:
        - categoryId
        - name
      properties:
        categoryId:
          type: string
          format: uuid
          example: "f47ac10b-58cc-4372-a567-0e02b2c3d479"
        name:
          type: string
          minLength: 1
          maxLength: 50
          example: "Food"
        description:
          type: string
          maxLength: 255
          example: "Groceries and restaurants"

    NewCategory:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          minLength: 2
          maxLength: 50
          example: "Food"
        description:
          type: string
          maxLength: 255
          example: "Groceries and restaurants"

    ShoppingList:
      type: object
      properties:
        shoppingListId:
          type: string
          format: uuid
          example: "c3d4e5f6-g7h8-9012-3456-789012cdefgh"
        name:
          type: string
          example: "Weekend shopping"
        createdAt:
          type: string
          format: date-time
          example: "2025-11-10T09:00:00Z"
        items:
          type: array
          items:
            $ref: '#/components/schemas/ShoppingListItem'
        itemCount:
          type: integer
          minimum: 0
          example: 12

    NewShoppingList:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 100
          example: "Weekend shopping"
        items:
          type: array
          items:
            $ref: '#/components/schemas/NewShoppingListItem'

    ShoppingListItem:
      type: object
      properties:
        shoppingListItemId:
          type: string
          format: uuid
          example: "d4e5f6g7-h8i9-0123-4567-890123defghi"
        productName:
          type: string
          example: "Bread"
        quantity:
          type: integer
          default: 1
          example: 2
        unit:
          type: string
          example: "pcs."
        isPurchased:
          type: boolean
          default: false
          example: false

    NewShoppingListItems:
      type: object
      required:
        - items
      properties:
        items:
          type: array
          minItems: 1
          items:
            $ref: "#/components/schemas/NewShoppingListItem"

    NewShoppingListItem:
      type: object
      required:
        - productName
      properties:
        productName:
          type: string
          minLength: 1
          maxLength: 100
          example: "Butter"

    OcrResult:
      type: object
      properties:
        expenses:
          type: array
          items:
            $ref: '#/components/schemas/OcrResultExpenseItem'

    Role:
      type: string
      enum:
        - ROLE_USER
        - ROLE_ADMIN

    RefreshedToken:
      type: object
      properties:
        token:
          type: string
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."

    MonthlyBudget:
      type: object
      properties:
        budgetId:
          type: string
          format: uuid
          example: "e5f6g7h8-i9j0-1234-5678-901234efghij"
        year:
          type: integer
          example: 2025
        month:
          type: integer
          example: 11
        budget:
          type: number
          format: float
          example: 5000.00
        categoryBudgets:
          type: array
          items:
            $ref: '#/components/schemas/CategoryBudget'

    NewMonthlyBudget:
      type: object
      required:
        - budget
        - year
        - month
      properties:
        budget:
          type: number
          format: float
          minimum: 0.00
          example: 5000.00
        year:
          type: integer
          minimum: 2020
          maximum: 2100
          example: 2025
        month:
          type: integer
          minimum: 1
          maximum: 12
          example: 11
        categoryBudgets:
          type: array
          items:
            $ref: '#/components/schemas/NewCategoryBudget'

    CategoryBudget:
      type: object
      properties:
        categoryBudgetId:
          type: string
          format: uuid
          example: "f6g7h8i9-j0k1-2345-6789-012345fghijk"
        categoryId:
          type: string
          format: uuid
          example: "f47ac10b-58cc-4372-a567-0e02b2c3d479"
        categoryName:
          type: string
          example: "Food"
        budget:
          type: number
          format: float
          example: 1500.00

    NewCategoryBudget:
      type: object
      required:
        - categoryId
        - budget
      properties:
        categoryId:
          type: string
          format: uuid
          example: "f47ac10b-58cc-4372-a567-0e02b2c3d479"
        budget:
          type: number
          format: float
          minimum: 0.00
          example: 1500.00

    UserResponse:
      type: object
      properties:
        userId:
          type: string
          format: uuid
          example: "d4e5f6g7-h8i9-0123-4567-890123fghijk"
        email:
          type: string
          format: email
          example: "john.doe@gmail.com"
        role:
          $ref: "#/components/schemas/Role"

    NewUserByAdmin:
      type: object
      required:
        - email
        - password
        - role
      properties:
        email:
          type: string
          format: email
          example: "john.doe@gmail.com"
        password:
          type: string
          format: password
          example: "super_secret_password"
        role:
          $ref: "#/components/schemas/Role"

    YearlySpendingSummary:
      type: object
      properties:
        year:
          type: integer
          example: 2025
        monthlySummaries:
          type: array
          items:
            $ref: '#/components/schemas/MonthlySpendingSummaryItem'

    MonthlySpendingSummaryItem:
      type: object
      properties:
        month:
          type: integer
          minimum: 1
          maximum: 12
          example: 11
        totalSpending:
          type: number
          format: float
          example: 2450.00
        budget:
          type: number
          format: float
          example: 3000.00

    ErrorResponse:
      required:
        - errorId
        - timestamp
        - status
        - error
        - message
        - path
        - details
      properties:
        errorId:
          type: string
          format: uuid
          example: "f48ac10b-58cc-4372-a567-0e02b2c3d479"
        timestamp:
          type: string
          format: date-time
          example: "2025-11-15T14:30:00Z"
        status:
          type: integer
          example: 404
        error:
          type: string
          example: "Resource not found for this email"
        message:
          type: string
          example: "Resource not found"
        path:
          type: string
          example: "http://localhost:8080/api/v1.0/categories"
        details:
          type: array
          items:
            type: string
          example: ["Resource with provided ID does not exist"]